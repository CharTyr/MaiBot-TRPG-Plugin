# MaiBot TRPG DM 跑团插件配置文件
# 详细说明请参考 README.md

[plugin]
# 配置文件版本
config_version = "1.2.0"
# 是否启用插件
enabled = true
# 允许启用跑团的群组ID列表，格式：["qq:123456:group", "qq:654321:group", ...]
# 留空表示所有群组都可以使用（需要手动 /trpg start 启用）
allowed_groups = []

[session]
# 自动保存间隔（秒）
auto_save_interval = 300
# 历史记录最大条数（影响 AI 上下文长度）
max_history_length = 50
# 是否在群组中显示详细日志
verbose_mode = false
# 是否允许玩家中途加入
allow_mid_join = true
# 中途加入时是否需要 DM 确认（管理员）
mid_join_require_confirm = false

[save_slots]
# 存档插槽数量（每个群组独立）
max_slots = 3
# 是否允许覆盖已有存档
allow_overwrite = true

[dice]
# 默认骰子面数
default_dice_sides = 20
# 单次最大骰子数量
max_dice_count = 100
# 单个骰子最大面数
max_dice_sides = 1000
# 是否显示每个骰子的结果
show_individual_rolls = true

[player]
# 默认属性值
default_attribute_value = 10
# 默认最大生命值
default_max_hp = 20
# 默认最大魔力值
default_max_mp = 10
# 背包最大容量
max_inventory_size = 50

[world]
# 默认世界观名称
default_world_name = "通用奇幻世界"
# 默认时间状态
default_time = "day"
# 默认天气
default_weather = "sunny"

[dm]
# 是否使用 MaiBot 主程序的 replyer 模型（推荐开启）
use_maibot_replyer = true
# DM 响应的温度参数（0.0-2.0，越高越有创意）
llm_temperature = 0.8
# DM 响应的最大 token 数
llm_max_tokens = 800
# 是否启用自动剧情生成（关闭则只响应命令）
auto_narrative = true
# NPC 对话风格: immersive(沉浸式), simple(简洁)
npc_style = "immersive"
# DM 人格提示词（简短为佳，会附加到系统提示词）
dm_personality = "你是一个经验丰富的跑团主持人，擅长营造氛围和推动剧情。"
# 是否在回复中包含行动建议
include_action_hints = true
# 是否在玩家行动时立即发送确认反馈（推荐开启，让玩家知道动作已被接收）
show_action_feedback = true
# DM 响应生成失败时的最大重试次数
max_retries = 3
# 重试间隔基础时间（秒），实际等待时间会使用指数退避
retry_delay = 1.0

[integration]
# 跑团模式下是否完全接管消息处理（推荐开启）
takeover_message = true
# 接管时是否阻止其他插件处理消息
block_other_plugins = true
# 是否使用 MaiBot 的人格设定融合 DM 角色
merge_bot_personality = true

[multiplayer]
# 是否启用多人行动批量处理（多人模组推荐开启）
batch_actions = true
# 行动收集时间窗口（秒），在此时间内的行动会被合并处理
action_collect_window = 5.0
# 收集窗口结束后的额外等待时间（秒），给慢手玩家更多时间
extra_wait_time = 2.0

[permissions]
# 管理员用户ID列表（可以使用 /dm 命令），格式：["123456", "654321"]
admin_users = []
# 是否允许玩家自行修改属性
allow_player_edit_attributes = false
# 是否允许玩家查看其他玩家状态
allow_view_others = true
# 是否允许非管理员结束跑团
allow_player_end_session = false

[module]
# 自定义模组目录（相对于插件目录）
custom_module_dir = "data/modules"
# Markdown 模组目录（相对于插件目录）
markdown_module_dir = "custom_modules"
# 是否自动扫描 Markdown 模组
auto_scan_markdown = true
# 是否允许导入 PDF 模组
allow_pdf_import = true
# PDF 解析使用的模型（需要支持长文本）
pdf_parse_model = "utils"

[image]
# 是否启用场景图片生成
enabled = false
# 生图 API 类型：openai, gradio, sd_api, novelai
api_type = "sd_api"
# API 基础 URL（sd_api 示例: http://127.0.0.1:7860）
base_url = "https://sd.exacg.cc"
# API 密钥（sd_api 可留空，openai/novelai 必填）
api_key = "sk-IJL68bU21d2UbV8HQQ2ExcLg5BkbvVP7BtS_6G4nivg"
# 模型名称（OpenAI 格式需要）
model_name = ""
# 默认图片尺寸预设：portrait(竖版768x1024), landscape(横版1024x768), wide(宽幅1024x512)
# 注意：planner 会根据场景自动选择最合适的尺寸（角色特写用portrait，场景用landscape，全景用wide）
default_size_preset = "landscape"
# 自定义尺寸（优先于预设，设为0则使用预设或planner推荐）
custom_width = 0
custom_height = 0
# 是否自动在关键剧情点生成图片
auto_generate = false
# 自动生成的触发间隔（条消息）
auto_generate_interval = 10
# 是否在剧情高潮时自动生成图片（推荐开启，会检测战斗胜利、真相揭露等关键时刻）
climax_auto_image = true
# 高潮检测的最小间隔（历史条数，避免频繁生成图片）
climax_min_interval = 5
# 场景图片提示词前缀（会自动添加到生成的提示词前面）
prompt_prefix = "fantasy illustration, detailed background, "
# 角色立绘提示词前缀
character_prompt_prefix = "character portrait, detailed, "

# ===== SD API 专用配置（参考 API 文档）=====
[image.sd_api]
# 负面提示词 negative_prompt (string, 默认"")
negative_prompt = "lowres, {bad}, error, fewer, extra, missing, worst quality, jpeg artifacts, bad quality, watermark, unfinished, displeasing, chromatic aberration, signature, extra digits, artistic error, username, scan, [abstract]"
# 图像宽度 width (integer, 64-2048, 默认512)，设为0则使用 default_size_preset
width = 0
# 图像高度 height (integer, 64-2048, 默认512)，设为0则使用 default_size_preset
height = 0
# 生成步数 steps (integer, 1-50, 默认20)
steps = 8
# CFG 引导强度 cfg (float, 1-10, 默认7.0)
cfg = 7.0
# 模型索引 model_index (integer, 默认0)，参考 API 返回的模型列表
model_index = 5
# 随机种子 seed (integer, 默认-1)，-1为随机
seed = -1
# 请求超时时间（秒）
timeout = 120

# ===== Gradio API 专用配置 =====
[image.gradio]
# 图片分辨率（格式如 "1024x1024 ( 1:1 )"）
resolution = "1024x1024 ( 1:1 )"
# 推理步数
steps = 8
# 时间偏移参数
shift = 3
# 轮询超时时间（秒）
timeout = 120

# ===== NovelAI API 专用配置 =====
[image.novelai]
# 模型名称
model = "nai-diffusion-4-5-full"
# 图像宽度
width = 832
# 图像高度
height = 1216
# 生成步数
steps = 28
# 引导强度
scale = 5.0
# 采样器
sampler = "k_euler"
# 负面提示词
negative_prompt = ""
# 随机种子，-1为随机
seed = -1
# 请求超时时间（秒）
timeout = 120

[llm_models]
# 各功能使用的模型组配置
# 留空表示使用默认模型
# DM 响应使用的模型（推荐 replyer）
dm_response_model = "replyer"
# 场景图片提示词生成使用的模型（推荐 planner）
image_prompt_model = "planner"
# PDF 解析使用的模型（推荐 utils，需要支持长文本）
pdf_parse_model = "utils"
# 意图理解使用的模型（推荐 planner）
intent_model = "planner"
