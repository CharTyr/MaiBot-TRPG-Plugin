# MaiBot TRPG DM 跑团插件

将 MaiBot 变成专业的 TRPG 跑团 DM（游戏主持人），支持完整的跑团功能。

## 功能特性

- 🎲 **骰子系统**: 支持标准骰子表达式 (XdY+Z)，属性检定，对抗检定
- 👤 **玩家管理**: 角色创建、属性设置、HP/MP 管理
- 🎒 **背包系统**: 物品添加、移除、使用
- 🌍 **世界状态**: 时间、天气、位置管理
- 📖 **剧情生成**: AI 驱动的剧情叙述和 NPC 对话
- 💾 **数据持久化**: 自动保存，重启后恢复
- 🔒 **群组隔离**: 不同群组完全独立

## 命令列表

### 会话管理
| 命令 | 说明 |
|------|------|
| `/trpg start [世界观]` | 开始新的跑团会话 |
| `/trpg end` | 结束当前跑团会话 |
| `/trpg status` | 查看会话状态 |
| `/trpg save` | 手动保存存档 |
| `/trpg pause` | 暂停跑团 |
| `/trpg resume` | 继续跑团 |

### 玩家操作
| 命令 | 说明 |
|------|------|
| `/join [角色名]` | 加入跑团，创建角色 |
| `/pc show` | 查看角色卡 |
| `/pc set [属性] [值]` | 设置角色属性 |
| `/pc leave` | 离开跑团 |
| `/hp [+/-数值]` | 修改生命值 |
| `/mp [+/-数值]` | 修改魔力值 |

### 背包系统
| 命令 | 说明 |
|------|------|
| `/inv` | 查看背包 |
| `/inv add [物品] [数量]` | 添加物品 |
| `/inv remove [物品] [数量]` | 移除物品 |
| `/inv use [物品]` | 使用物品 |

### 骰子命令
| 命令 | 说明 |
|------|------|
| `/r d20` | 掷一个20面骰 |
| `/r 2d6+3` | 掷两个6面骰加3 |
| `/r 3d8-2` | 掷三个8面骰减2 |
| `/r 1d100` | 掷一个百面骰 |

### DM 命令（管理员）
| 命令 | 说明 |
|------|------|
| `/dm time [时间]` | 设置世界时间 (day/night/dawn/dusk) |
| `/dm weather [天气]` | 设置天气 (sunny/rainy/cloudy/stormy) |
| `/dm location [位置]` | 设置当前位置 |
| `/dm npc [名称] [动作]` | 控制 NPC |
| `/dm event [描述]` | 触发事件 |
| `/dm describe` | 描述当前环境 |

### 世界观设定
| 命令 | 说明 |
|------|------|
| `/lore` | 查看所有世界观设定 |
| `/lore add [内容]` | 添加世界观设定 |
| `/lore search [关键词]` | 搜索世界观设定 |

## 角色扮演

在跑团进行中，玩家可以直接发送角色扮演消息，DM 会自动响应：

```
*拔出长剑，警惕地观察四周*
（小心翼翼地推开门）
"你好，请问这里是冒险者公会吗？"
```

## 配置说明

编辑 `config.toml` 文件来自定义插件行为：

```toml
[plugin]
enabled = true

[session]
enabled_groups = []  # 允许的群组ID列表
auto_save_interval = 300  # 自动保存间隔（秒）

[dice]
max_dice_count = 100  # 单次最大骰子数
max_dice_sides = 1000  # 单个骰子最大面数

[dm]
llm_temperature = 0.8  # AI 创意程度
auto_narrative = true  # 自动生成剧情
```

## 数据存储

所有数据存储在 `data/` 目录下：

```
data/
├── sessions/      # 会话数据
├── players/       # 玩家数据
├── lore/          # 世界观设定
└── config/        # 运行时配置
```

## 预设模组

插件内置了多个精心设计的预设模组，可以直接使用：

### 🗡️ 龙穴探险 (dragon_cave)
- 类型: 奇幻冒险
- 难度: 🟢 简单
- 人数: 3-5人
- 时长: 2-4小时
- 简介: 传说中的巨龙斯莫格已经沉睡百年，它的巢穴中藏着无尽的宝藏...

### 👻 幽灵庄园 (haunted_mansion)
- 类型: 恐怖调查
- 难度: 🟡 普通
- 人数: 2-4人
- 时长: 2-3小时
- 简介: 一座废弃多年的维多利亚式庄园，据说藏着不为人知的秘密...

### 🚀 霓虹暗影 (cyberpunk_heist)
- 类型: 赛博朋克
- 难度: 🔴 困难
- 人数: 3-4人
- 时长: 3-4小时
- 简介: 2087年，新东京。一次高风险的企业潜入任务...

### 模组命令
| 命令 | 说明 |
|------|------|
| `/module list` | 列出所有可用模组 |
| `/module info [模组ID]` | 查看模组详情 |
| `/trpg start [模组ID]` | 使用模组开始跑团 |

## 快速开始

### 使用预设模组（推荐新手）
1. 发送 `/module list` 查看可用模组
2. 发送 `/trpg start dragon_cave` 开始龙穴探险
3. 玩家发送 `/join 勇士小明` 加入游戏
4. 按照剧情提示进行冒险！

### 自由模式
1. 在群组中发送 `/trpg start 克苏鲁神话` 开始自定义跑团
2. 玩家发送 `/join 调查员小明` 加入游戏
3. 使用 `/r d100` 进行技能检定
4. 直接发送角色扮演内容，DM 会自动响应
5. 使用 `/trpg end` 结束跑团

## 注意事项

- 插件仅在 `plugins/MaiBot_TRPG_DM/` 目录内操作，不会修改 MaiBot 主程序
- 每个群组的数据完全隔离
- 重启 MaiBot 后会自动恢复未结束的跑团会话
- 建议定期使用 `/trpg save` 手动保存重要进度

## 许可证

GPL-3.0-or-later
